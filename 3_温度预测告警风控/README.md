# 温度预测系统

基于LSTM时序模型的开关柜温度预测和告警系统。

Tips：
- 1.该代码最最最初代的版本的（3年前），有很多不完善的地方，这个抛出来纪念我第一只脚踏进风控这个领域的时候。
- 2.该版本有很多不可深究的一些问题，比如数据的形状，聚类时候的一些超参数，规则判断和怎么进行长时间预测都没有进行修改，只是最初的版本。
- 3.因为一些原因，所以没有公开数据集，也没有任何后续的步骤（包括自动训练模型，grpc版本的传参数，加入电压这个特征，LSTM模型的设计和训练，自动加入数据和每隔一段时间的自动化训练等等）都不会再抛出来了，这个仅供参考！！！
- 4.我用codex进行了一些修改让这个可以真的跑起来，你可以自行实验，也可以改一些东西包装成你的项目。


## 📁 文件结构

```
xxx/
├── service.py              # 主运行文件
├── predictProcess.py        # 预测处理核心模块
├── predictAnswer.py         # 模型预测接口
├── dataProcess.py           # 数据处理模块
├── alert.py                 # 告警等级计算
├── assessment.py            # 健康评估模块
├── input.txt                # 输入温度数据（6行，每行n列）
├── record.txt               # 历史数据记录文件（自动生成和更新）
├── demo/
└── model_data/              # LSTM模型文件目录
    └── model.keras
```

## 🛠️ 技术栈
| 功能模块 | 技术/算法 | 说明 |
|---------|----------|------|
| **时序预测** | LSTM+变体 | 使用深度学习LSTM模型进行温度时序预测 |
| **数据标准化** | Z-score标准化 | 预测前对数据进行均值方差标准化预测后反标准化 |
| **健康评估** | KMeans聚类 | 使用KMeans将历史数据分为5个簇，找出主簇并评估健康等级 |
| **告警计算** | 方差比较 + 阈值判断 | 通过比较预测方差和历史方差，结合阈值判断告警等级 |
| **三相不平衡检测** | 偏差率计算 | 计算各点位相对于同组平均值的偏差率，检测三相不平衡 |
| **数据处理** | NumPy | 数组操作、数据补全、滑动窗口等 |

## 🚀 运行方法

直接运行主程序：

```bash
python service.py
```

运行后会显示：
- 输入参数信息
- 预测计算过程
- 详细的预测结果输出（包括温度预测、告警等级、健康评估等）
- 
## 🔄 系统流程图

```
读取input.txt  →  读取record.txt  →  数据预处理  →  LSTM模型预测  →  告警计算  →  健康评估  →  输出结果  →  更新record.txt
    ↓                  ↓                 ↓              ↓              ↓            ↓            ↓              ↓
当前时刻温度数据   历史数据(96点)   补全数据、检测    使用96个历史    三相不平衡    聚类分析    预测温度、     追加新数据到
(6点位×n开关柜)    滑动窗口保存     损坏/关机状态    时间点预测      → 告警等级    → 健康等级   告警、评估     历史记录
                                                 下一时刻/长期      (0-3级)      (1-5级)
```


## 📊 输入输出参数说明

### 输入参数

| 参数 | 形状 | 说明 | 来源 |
|------|------|------|------|
| **dataReal** | 6×n | 温度数据（6个点位×n个开关柜）<br/>点位：[上A, 上B, 上C, 下A, 下B, 下C] | `input.txt` |
| **time** | 1 | 预测时间长度 | 代码中设置 |
| **instant** | 1×n | 当前负载 | 代码中设置 |
| **rate** | 1×n | 额定负载 | 代码中设置 |
| **fan** | 1 | 风机属性 | 代码中设置 |
| **dataHistory** | 6×n×(time×96) | 同期历史温度数据 | 代码中设置 |

### 输出参数

| 参数 | 形状 | 说明 |
|------|------|------|
| **dataPredict** | n×6 | 下一时刻预测温度 |
| **isOpen** | n×6 | 开关柜活跃状态（True=通电, False=断电） |
| **dataPredictLongTime** | 6×n×(time×96) | 长时间预测结果（当time>0时） |
| **level** | 标量/矩阵 | 告警等级（0=正常, 1=一级, 2=二级, 3=三级） |
| **healthAssessment** | 1×n | 健康评估等级（1-5级，1最健康，5最严重） |

## ⚠️ 注意事项

### 历史数据要求
- **时序模型需要至少96个历史时间点才能进行真正的预测**
- 如果历史数据不足96个时间点，系统会返回最后一个历史值作为预测（预测值=输入值）
- 模型输入序列长度固定为96（代表一天24小时×每15分钟一个数据点）
- 不能随意修改输入序列长度，否则会导致模型报错


### 其他注意事项
- `record.txt` 会自动保存和更新历史数据，请不要手动删除
- 每次运行程序会将新的 `input.txt` 数据追加到 `record.txt`


